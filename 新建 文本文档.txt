uwsgi.ini

[uwsgi]
chdir = /var/MJproject_noDocker/MJv1BE
module = MJv1BE.wsgi:application
socket = /var/run/uwsgi/MJv1BE.sock
workers = 4
pidfile = /var/run/uwsgi/MJv1BE.pid
uid = www-data
gid = www-data
master = true
vacuum = true
daemonize = /var/log/uwsgi/MJv1BE.log
virtualenv = /var/MJproject_noDocker/MJv1BE/venv



uwsgi-MJv1BE.service

[Unit]
Description=uWSGI MJv1BE Django Service
After=network.target
Requires=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/MJproject_noDocker/MJv1BE
Environment="PATH=/var/MJproject_noDocker/MJv1BE/venv/bin:/usr/sbin:/usr/bin:/sbin:/bin"
ExecStart=/var/MJproject_noDocker/MJv1BE/venv/bin/uwsgi --ini /var/MJproject_noDocker/MJv1BE/uwsgi.ini
ExecStop=/var/MJproject_noDocker/MJv1BE/venv/bin/uwsgi --stop /var/run/uwsgi/MJv1BE.pid
ExecReload=/var/MJproject_noDocker/MJv1BE/venv/bin/uwsgi --reload /var/run/uwsgi/MJv1BE.pid
Restart=always
RestartSec=10s
KillSignal=SIGQUIT
Type=forking

[Install]
WantedBy=multi-user.target



server {  
    listen 80;  
    server_name 193.112.246.221;  
    access_log /var/log/nginx/vue_app.log;  
    
    # 全局禁用缓存（按需在location中覆盖）  
    add_header Cache-Control "no-cache";  

    # 静态资源服务（Django）  
    # location /django_static/ {  
    #     alias /var/MJproject_noDocker/MJv1BE/staticfiles/;  
    #     add_header Cache-Control "public, max-age=31536000";  # 长期缓存  
    # }  

    # 新增: 静态文件服务  
    location /apimedia/ {  
        alias /var/MJproject_noDocker/MJv1BE/media/apimedia/;  # 指向存放图片的实际目录  
        add_header Cache-Control "public, max-age=31536000";  # 长期缓存，可以根据需求调整  
        access_log off;  # 不记录访问日志，可以关闭以减小日志文件大小  
        expires 30d;  # 设置过期时间，客户端会缓存30天  
    }  

    # API动态请求  
    location /api/ {  
        include uwsgi_params;  
        uwsgi_pass unix:/var/run/uwsgi/MJv1BE.sock;  
        # 移除SCRIPT_NAME和modifier1参数  
    }  

    # 前端SPA服务  
    location / {  
        root /var/MJproject_noDocker/MJv1FE/dist;  
        index index.html;  
        try_files $uri $uri/ /index.html;  
        add_header Cache-Control "no-cache, max-age=0";  # 覆盖全局设置  
    }  

    error_page 500 502 503 504 /50x.html;  
    location = /50x.html {  
        root /usr/share/nginx/html;  
    }  
}  